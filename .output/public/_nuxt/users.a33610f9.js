import{u as k}from"./fetch.23709f3e.js";import{u as P,_ as I}from"./Error.vue.49b1e664.js";import{H as J,n as U,s as E,x as L,q as s,o as S,y as F,w as i,b as e,a as V,c as $,F as G,z as K,u as a,t as T,r as H,B as z,C as Z,D as O,E as R,d as B,V as Q,G as X,I as ee,v as A}from"./entry.ee28b950.js";import{u as te}from"./service.50aeee36.js";import{R as y}from"./index.23a86e31.js";const N=J("user",{state:()=>({users:[],showForm:!1,loading:!1,current:null,showConfirm:!1,showChangePassword:!1}),actions:{async getUsers(){var o;const{data:r}=await k("/api/user","$skGXEh7uod");this.users=(o=r.value)==null?void 0:o.data},async create(r){const o=P();o.resetError(),this.loading=!0;const{data:u,error:l}=await k("/api/user",{method:"POST",body:r},"$dHxgorQbTP");this.loading=!1,l.value?o.setError(l.value.statusMessage):(this.users.push(u.value),this.showForm=!1)},async update(r){const o=P();o.resetError(),this.loading=!0;const{data:u,error:l}=await k("/api/user",{method:"PATCH",body:r},"$8dM5SCvYiu");this.loading=!1,l.value?o.setError(l.value.statusMessage):(this.users=this.users.map(d=>d._id===r._id?u.value:d),this.showForm=!1)},async changePassword(r){const o=P();o.resetError(),this.loading=!0;const{data:u,error:l}=await k("/api/user/change-password",{method:"PUT",body:r},"$zQ0LwgiUW6");this.loading=!1,l.value?o.setError(l.value.statusMessage):this.showChangePassword=!1},async delete(r){this.loading=!0,await k(`/api/user/${r}`,{method:"DELETE"},"$LBSBx8XOkA"),this.loading=!1,this.users=this.users.filter(o=>o._id!==r),this.showConfirm=!1},setShowForm(r){this.showForm=r},setShowChangePassword(r){this.showChangePassword=r},setCurrent(r){this.current=r},setShowConfirm(r){this.showConfirm=r}}}),oe=V("thead",null,[V("tr",null,[V("th",null,"Nombre completo"),V("th",null,"Email"),V("th",null,"Rol"),V("th",null,"Servicio"),V("th",null,"Acciones")])],-1),le=U({__name:"TableUsers",async setup(r){let o,u;const l=N(),{users:d}=E(l);[o,u]=L(()=>l.getUsers()),await o,u();const f=n=>{l.setCurrent(n),l.setShowForm(!0)},x=n=>{l.setCurrent(n),l.setShowChangePassword(!0)},_=n=>{l.setCurrent(n),l.setShowConfirm(!0)};return(n,t)=>{const m=s("VBtn"),w=s("VTable"),g=s("VCard");return S(),F(g,{elevation:"5"},{default:i(()=>[e(w,null,{default:i(()=>[oe,V("tbody",null,[(S(!0),$(G,null,K(a(d),c=>(S(),$("tr",null,[V("td",null,T(c.fullName),1),V("td",null,T(c.email),1),V("td",null,T(c.rol),1),V("td",null,T(c!=null&&c._service?c._service.name:"Todos"),1),V("td",null,[e(m,{icon:"mdi-lock-reset",color:"success",variant:"text",title:"Cambiar contraseña",onClick:v=>x(c)},null,8,["onClick"]),e(m,{icon:"mdi-eye",color:"warning",variant:"text",title:"Editar",onClick:v=>f(c)},null,8,["onClick"]),e(m,{icon:"mdi-delete",color:"error",variant:"text",title:"Eliminar",onClick:v=>_(c)},null,8,["onClick"])])]))),256))])]),_:1})]),_:1})}}}),ae=U({__name:"FormUser",async setup(r){let o,u;const l=H(null),d=N(),f=te(),{services:x}=E(f),{loading:_,current:n}=E(d),t=z({fullName:"",email:"",rol:null,_service:""}),m={required:[p=>!!p||"campo requerido!"],email:[p=>!!p||"El correo es requerido",p=>/.+@.+\..+/.test(p)||"El correo debe ser válido"]};[o,u]=L(()=>f.getServices()),await o,u();const w=[{value:y.ADMIN,title:"Administrador"},{value:y.ASSISTANT,title:"Asistente"}],g=Z(()=>n.value?"Editar":"Agregar"),c=async()=>{const{valid:p}=await l.value.validate();p&&(n.value?await d.update({_id:n.value._id,fullName:t.fullName,rol:t.rol,_service:t.rol===y.ADMIN?void 0:t._service}):await d.create({...t,rol:t.rol,_service:t.rol===y.ADMIN?void 0:t._service}))},v=()=>{d.setShowForm(!1)};return O(()=>{var p;n.value&&(t.fullName=n.value.fullName,t.email=n.value.email,t.rol=n.value.rol,t._service=((p=n.value._service)==null?void 0:p._id)??"")}),R(()=>{d.setCurrent(null)}),(p,C)=>{const h=s("VCardTitle"),W=I,D=s("VTextField"),M=s("VSelect"),q=s("VBtn"),Y=s("VCardText"),j=s("VCard");return S(),F(j,{elevation:"5"},{default:i(()=>[e(h,{class:"text-center text-h4"},{default:i(()=>[B(T(a(g))+" usuario ",1)]),_:1}),e(Y,null,{default:i(()=>[e(a(Q),{ref_key:"formRef",ref:l,onSubmit:X(c,["prevent"])},{default:i(()=>[e(W),e(D,{class:"mt-3",modelValue:a(t).fullName,"onUpdate:modelValue":C[0]||(C[0]=b=>a(t).fullName=b),variant:"outlined",label:"Nombre",rules:m.required},null,8,["modelValue","rules"]),e(D,{class:"mt-1",type:"email",modelValue:a(t).email,"onUpdate:modelValue":C[1]||(C[1]=b=>a(t).email=b),variant:"outlined",label:"Email",rules:m.email,disabled:!!a(n)},null,8,["modelValue","rules","disabled"]),e(M,{class:"mt-1",variant:"outlined",rules:m.required,modelValue:a(t).rol,"onUpdate:modelValue":C[2]||(C[2]=b=>a(t).rol=b),label:"Rol",items:w,"item-title":"title","item-value":"value"},null,8,["rules","modelValue"]),a(t).rol===a(y).ASSISTANT?(S(),F(M,{key:0,class:"mt-1",variant:"outlined",rules:m.required,modelValue:a(t)._service,"onUpdate:modelValue":C[3]||(C[3]=b=>a(t)._service=b),label:"Servicios",items:a(x),"item-title":"name","item-value":"_id"},null,8,["rules","modelValue","items"])):ee("",!0),e(q,{class:"mt-4",variant:"tonal",type:"submit",loading:a(_),block:"",color:"primary",text:"Guardar"},null,8,["loading"]),e(q,{class:"mt-2",variant:"tonal",disabled:a(_),color:"error",block:"",onClick:v,text:"Cancelar"},null,8,["disabled"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}}}),se=U({__name:"FormChangePassword",setup(r){const o=H(null),u=N(),{loading:l,current:d}=E(u),f=z({email:"",password:""}),x={password:[t=>!!t||"La contraseña es requerida",t=>t&&t.length>=8||"La contraseña debe tener al menos 8 caracteres"]},_=async()=>{const{valid:t}=await o.value.validate();t&&d.value&&await u.changePassword({email:d.value.email,password:f.password})},n=()=>{u.setShowChangePassword(!1)};return O(()=>{d.value&&(f.email=d.value.email)}),R(()=>{u.setCurrent(null)}),(t,m)=>{const w=s("VCardTitle"),g=I,c=s("VTextField"),v=s("VBtn"),p=s("VCardText"),C=s("VCard");return S(),F(C,{elevation:"5"},{default:i(()=>[e(w,{class:"text-center text-h4"},{default:i(()=>[B(" Cambiar contraseña ")]),_:1}),e(p,null,{default:i(()=>[e(a(Q),{ref_key:"formRef",ref:o,onSubmit:X(_,["prevent"])},{default:i(()=>[e(g),e(c,{class:"mt-1",type:"email",modelValue:a(f).email,"onUpdate:modelValue":m[0]||(m[0]=h=>a(f).email=h),variant:"outlined",label:"Email",disabled:""},null,8,["modelValue"]),e(c,{class:"mt-3",modelValue:a(f).password,"onUpdate:modelValue":m[1]||(m[1]=h=>a(f).password=h),variant:"outlined",label:"Password",rules:x.password},null,8,["modelValue","rules"]),e(v,{class:"mt-4",variant:"tonal",type:"submit",loading:a(l),block:"",color:"primary",text:"Guardar"},null,8,["loading"]),e(v,{class:"mt-2",variant:"tonal",disabled:a(l),color:"error",block:"",onClick:n,text:"Cancelar"},null,8,["disabled"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}}}),re=U({__name:"ConfirmUser",setup(r){const o=N(),{current:u,loading:l}=E(o),d=()=>{o.setShowConfirm(!1)},f=async()=>{await o.delete(u.value._id)};return R(()=>{o.setCurrent(null)}),(x,_)=>{const n=s("VCardTitle"),t=s("VCardText"),m=s("VSpacer"),w=s("VBtn"),g=s("VCardActions"),c=s("VCard");return S(),F(c,null,{default:i(()=>[e(n,{class:"text-center"},{default:i(()=>[B(" Eliminar usuario ")]),_:1}),e(t,null,{default:i(()=>{var v;return[B(" ¿Estás seguro de eliminar a "+T((v=a(u))==null?void 0:v.fullName)+"? ",1)]}),_:1}),e(g,null,{default:i(()=>[e(m),e(w,{variant:"tonal",text:"Cancelar",onClick:d,disabled:a(l),color:"error"},null,8,["disabled"]),e(w,{variant:"tonal",text:"Confirmar",onClick:f,loading:a(l),color:"primary"},null,8,["loading"])]),_:1})]),_:1})}}}),ne=V("h2",{class:"text-center text-h3"},"Usuarios",-1),_e=U({__name:"users",setup(r){const o=N(),{showForm:u,showConfirm:l,showChangePassword:d}=E(o),f=()=>{o.setShowForm(!0)};return(x,_)=>{const n=s("VCol"),t=s("VRow"),m=s("VBtn"),w=le,g=s("VContainer"),c=ae,v=s("VDialog"),p=se,C=re;return S(),$(G,null,[e(g,null,{default:i(()=>[e(t,null,{default:i(()=>[e(n,null,{default:i(()=>[ne]),_:1})]),_:1}),e(t,null,{default:i(()=>[e(n,null,{default:i(()=>[e(m,{color:"success",icon:"mdi-plus",onClick:_[0]||(_[0]=h=>f())})]),_:1})]),_:1}),e(t,null,{default:i(()=>[e(n,null,{default:i(()=>[e(w)]),_:1})]),_:1})]),_:1}),e(v,{modelValue:a(u),"onUpdate:modelValue":_[1]||(_[1]=h=>A(u)?u.value=h:null),persistent:"","max-width":"650"},{default:i(()=>[e(c)]),_:1},8,["modelValue"]),e(v,{modelValue:a(d),"onUpdate:modelValue":_[2]||(_[2]=h=>A(d)?d.value=h:null),persistent:"","max-width":"650"},{default:i(()=>[e(p)]),_:1},8,["modelValue"]),e(v,{modelValue:a(l),"onUpdate:modelValue":_[3]||(_[3]=h=>A(l)?l.value=h:null),persistent:"","max-width":"450"},{default:i(()=>[e(C)]),_:1},8,["modelValue"])],64)}}});export{_e as default};
