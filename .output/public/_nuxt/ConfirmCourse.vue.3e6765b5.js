import{H as Z,n as P,J as ee,s as k,x as H,q as d,o as g,y as Y,w as l,b as e,a as c,c as q,F as R,z as G,u as a,t as V,d as $,K as te,r as ae,B as J,C as le,D as oe,E as K,V as ne,G as re}from"./entry.ee28b950.js";import{h as v,c as B}from"./index.89ded283.js";import{u as se}from"./service.50aeee36.js";import{u as ue}from"./teacher.72b3b57e.js";import{d as ie}from"./index.23a86e31.js";import{u as x}from"./fetch.23709f3e.js";const X=Z("course",{state:()=>({courses:[],showForm:!1,showConfirm:!1,loading:!1,current:null}),actions:{async create(i){this.loading=!0;const{data:u}=await x("/api/course",{body:i,method:"POST"},"$e5XGgdwATT");this.courses.push(u.value),this.loading=!1,this.showForm=!1},async getAll(i){const{data:u}=await x(`/api/course${i?"?idService="+i:""}`,"$DW8ycvAIQY");this.courses=u.value.data},async update(i){this.loading=!0;const{data:u}=await x("/api/course",{method:"PATCH",body:i},"$ynEEKJf8oS");this.loading=!1,this.showForm=!1,this.courses=this.courses.map(p=>p._id===i._id?u.value:p)},async delete(i){this.loading=!0,await x(`/api/course/${i}`,{method:"DELETE"},"$2Qi63FBHcD"),this.courses=this.courses.filter(u=>u._id!==i),this.loading=!1,this.showConfirm=!1},setShowForm(i){this.showForm=i},setCurrent(i){this.current=i},setShowConfirm(i){this.showConfirm=i}},getters:{coursesReportXLSX(i){return i.courses.map(u=>({nombre:u.name,inicio:v(u.startDate).format("DD-MM-YYYY"),fin:v(u.endDate).format("DD-MM-YYYY"),lugar:u.location,profesor:u._teacher.fullName}))}}}),de=c("thead",null,[c("tr",null,[c("th",null,"Nombre"),c("th",null,"Fecha"),c("th",null,"Lugar"),c("th",null,"Horarios"),c("th",null,"Profesor"),c("th",null,"Acciones")])],-1),he=P({__name:"TableCourse",async setup(i){let u,p;const{data:D,signOut:b}=ee(),h=X(),{courses:F}=k(h);[u,p]=H(()=>h.getAll(D.value._service)),await u,p();const E=n=>{h.setCurrent(n),h.setShowForm(!0)},M=n=>{h.setCurrent(n),h.setShowConfirm(!0)},A=n=>v(n).format("DD/MM/YYYY");return(n,t)=>{const m=d("VChip"),_=d("VChipGroup"),y=d("VBtn"),L=d("VTable"),U=d("VCard");return g(),Y(U,{elevation:"5"},{default:l(()=>[e(L,null,{default:l(()=>[de,c("tbody",null,[(g(!0),q(R,null,G(a(F),C=>(g(),q("tr",null,[c("td",null,V(C.name),1),c("td",null,V(A(C.startDate))+" - "+V(A(C.endDate)),1),c("td",null,V(C.location),1),c("th",null,[e(_,null,{default:l(()=>[(g(!0),q(R,null,G(C.schedules,w=>(g(),Y(m,null,{default:l(()=>[$(V(w.day)+" "+V(("convertUtcToLocalTime"in n?n.convertUtcToLocalTime:a(B))(w.startTime))+" - "+V(("convertUtcToLocalTime"in n?n.convertUtcToLocalTime:a(B))(w.endTime)),1)]),_:2},1024))),256))]),_:2},1024)]),c("th",null,V(C._teacher.fullName),1),c("td",null,[e(y,{icon:"mdi-eye",color:"warning",variant:"text",title:"Editar",onClick:w=>E(C)},null,8,["onClick"]),e(y,{icon:"mdi-delete",color:"error",variant:"text",title:"Eliminar",onClick:w=>M(C)},null,8,["onClick"]),e(y,{icon:"mdi-list-box-outline",color:"success",variant:"text",title:"Inscripciones",onClick:w=>("navigateTo"in n?n.navigateTo:a(te))(`/${a(D).rol}/inscription/${C._id}`)},null,8,["onClick"])])]))),256))])]),_:1})]),_:1})}}}),me=c("p",null,"Agregue el horario",-1),Ce=P({__name:"FormCourse",async setup(i){let u,p;const D=ae(null),b=X(),h=se(),F=ue(),{services:E}=k(h),{teachers:M}=k(F),{loading:A,current:n}=k(b),t=J({name:"",spaces:0,startDate:"",endDate:"",schedules:[],location:"",rangeAge:{min:12,max:50},_service:"",_teacher:""}),m=J({day:"",endTime:"",startTime:""}),_={required:[r=>!!r||"campo requerido!"],spaces:[r=>!!r||"campo requerido!",r=>r>=1||"debe ser positivo"],endDate:[r=>!!r||"campo requerido!",r=>!!t.startDate&&v(r).isAfter(v(t.startDate))||"Debe ser mayor que la fecha inicial"],minAge:[r=>!!r||"campo requerido!",r=>r>=1&&r<=120||"Edad inválida"],maxAge:[r=>t.rangeAge.min<=r||"no puede ser menor que la edad mínima"]},y=le(()=>n.value?"Editar curso":"Agregar curso"),L=async()=>{const{valid:r}=await D.value.validate();r&&(n.value?await b.update({...t,_id:n.value._id,startDate:v(t.startDate+"").utc().valueOf(),endDate:v(t.endDate).utc().valueOf(),schedules:t.schedules.map(o=>({...o,startTime:U(o.startTime),endTime:U(o.endTime)}))}):await b.create({...t,startDate:v(t.startDate+"").utc().valueOf(),endDate:v(t.endDate).utc().valueOf(),schedules:t.schedules.map(o=>({...o,startTime:U(o.startTime),endTime:U(o.endTime)}))}))},U=r=>v(`${v().format("yyyy-MM-DD")}T${r}`).utc().valueOf(),C=()=>{m.day!==""&&m.startTime!==""&&m.endTime!==""&&(t.schedules.push({...m}),m.day="",m.startTime="",m.endTime="")},w=()=>{b.setShowForm(!1)},I=r=>v(r).format("YYYY-MM-DD");return[u,p]=H(()=>h.getServices()),await u,p(),[u,p]=H(()=>F.getAll()),await u,p(),oe(()=>{n.value&&(t.name=n.value.name,t.spaces=n.value.spaces,t.location=n.value.location,t.startDate=I(n.value.startDate),t.endDate=I(n.value.endDate),t.rangeAge=n.value.rangeAge,t.schedules=n.value.schedules.map(r=>({...r,startTime:B(r.startTime),endTime:B(r.endTime)})),t._service=n.value._service,t._teacher=n.value._teacher._id)}),K(()=>{b.setCurrent(null)}),(r,o)=>{const Q=d("VCardTitle"),T=d("VTextField"),f=d("VCol"),S=d("VRow"),N=d("VSelect"),O=d("VBtn"),z=d("VChip"),W=d("VCardText"),j=d("VCard");return g(),Y(j,{elevation:"5"},{default:l(()=>[e(Q,{class:"text-center text-h4"},{default:l(()=>[$(V(a(y)),1)]),_:1}),e(W,null,{default:l(()=>[e(a(ne),{ref_key:"formRef",ref:D,onSubmit:re(L,["prevent"])},{default:l(()=>[e(S,null,{default:l(()=>[e(f,null,{default:l(()=>[e(T,{modelValue:a(t).name,"onUpdate:modelValue":o[0]||(o[0]=s=>a(t).name=s),variant:"outlined",label:"Nombre",rules:_.required},null,8,["modelValue","rules"])]),_:1}),e(f,null,{default:l(()=>[e(T,{type:"number",modelValue:a(t).spaces,"onUpdate:modelValue":o[1]||(o[1]=s=>a(t).spaces=s),modelModifiers:{number:!0},variant:"outlined",label:"Cupos",rules:_.spaces},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(S,null,{default:l(()=>[e(f,null,{default:l(()=>[e(T,{type:"date",variant:"underlined",label:"Fecha inicio",modelValue:a(t).startDate,"onUpdate:modelValue":o[2]||(o[2]=s=>a(t).startDate=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),e(f,null,{default:l(()=>[e(T,{type:"date",variant:"underlined",label:"Fecha fin",rules:_.endDate,modelValue:a(t).endDate,"onUpdate:modelValue":o[3]||(o[3]=s=>a(t).endDate=s),modelModifiers:{trim:!0}},null,8,["rules","modelValue"])]),_:1})]),_:1}),e(S,null,{default:l(()=>[e(f,null,{default:l(()=>[me]),_:1})]),_:1}),e(S,null,{default:l(()=>[e(f,null,{default:l(()=>[e(N,{label:"Día",items:a(ie),disabled:!a(t).startDate,modelValue:a(m).day,"onUpdate:modelValue":o[4]||(o[4]=s=>a(m).day=s)},null,8,["items","disabled","modelValue"])]),_:1}),e(f,null,{default:l(()=>[e(T,{type:"time",variant:"underlined",label:"Hora inicio",disabled:!a(t).startDate,modelValue:a(m).startTime,"onUpdate:modelValue":o[5]||(o[5]=s=>a(m).startTime=s),modelModifiers:{trim:!0}},null,8,["disabled","modelValue"])]),_:1}),e(f,null,{default:l(()=>[e(T,{type:"time",variant:"underlined",label:"Hora fin",disabled:!a(t).startDate,modelValue:a(m).endTime,"onUpdate:modelValue":o[6]||(o[6]=s=>a(m).endTime=s),modelModifiers:{trim:!0}},null,8,["disabled","modelValue"])]),_:1}),e(f,{cols:"auto"},{default:l(()=>[e(O,{color:"primary",icon:"mdi-plus",onClick:C,fab:"",disabled:!a(t).startDate},null,8,["disabled"])]),_:1})]),_:1}),e(S,null,{default:l(()=>[(g(!0),q(R,null,G(a(t).schedules,s=>(g(),Y(f,{cols:"auto"},{default:l(()=>[e(z,null,{default:l(()=>[$(V(s.day)+" "+V(s.startTime)+" - "+V(s.endTime),1)]),_:2},1024)]),_:2},1024))),256))]),_:1}),e(S,null,{default:l(()=>[e(f,null,{default:l(()=>[e(N,{variant:"outlined",modelValue:a(t)._service,"onUpdate:modelValue":o[7]||(o[7]=s=>a(t)._service=s),label:"Servicio",items:a(E),"item-title":"name","item-value":"_id",rules:_.required},null,8,["modelValue","items","rules"])]),_:1}),e(f,null,{default:l(()=>[e(N,{label:"Profesor",variant:"outlined",modelValue:a(t)._teacher,"onUpdate:modelValue":o[8]||(o[8]=s=>a(t)._teacher=s),items:a(M),"item-title":"fullName","item-value":"_id",rules:_.required},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),e(S,null,{default:l(()=>[e(f,null,{default:l(()=>[e(T,{modelValue:a(t).rangeAge.min,"onUpdate:modelValue":o[9]||(o[9]=s=>a(t).rangeAge.min=s),variant:"outlined",label:"Edad mínima",rules:_.minAge},null,8,["modelValue","rules"])]),_:1}),e(f,null,{default:l(()=>[e(T,{type:"number",modelValue:a(t).rangeAge.max,"onUpdate:modelValue":o[10]||(o[10]=s=>a(t).rangeAge.max=s),modelModifiers:{number:!0},variant:"outlined",label:"Edad máxima",rules:[..._.minAge,..._.maxAge]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(S,null,{default:l(()=>[e(f,null,{default:l(()=>[e(T,{modelValue:a(t).location,"onUpdate:modelValue":o[11]||(o[11]=s=>a(t).location=s),variant:"outlined",label:"Lugar",rules:_.required},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(O,{class:"mt-4",variant:"tonal",type:"submit",loading:a(A),block:"",disabled:a(t).schedules.length===0,color:"primary",text:"Guardar"},null,8,["loading","disabled"]),e(O,{class:"mt-2",variant:"tonal",disabled:a(A),color:"error",block:"",onClick:w,text:"Cancelar"},null,8,["disabled"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}}}),Te=P({__name:"ConfirmCourse",setup(i){const u=X(),{current:p,loading:D}=k(u),b=()=>{u.setShowConfirm(!1)},h=async()=>{await u.delete(p.value._id)};return K(()=>{u.setCurrent(null)}),(F,E)=>{const M=d("VCardTitle"),A=d("VCardText"),n=d("VSpacer"),t=d("VBtn"),m=d("VCardActions"),_=d("VCard");return g(),Y(_,null,{default:l(()=>[e(M,{class:"text-center"},{default:l(()=>[$(" Eliminar curso ")]),_:1}),e(A,null,{default:l(()=>{var y;return[$(" ¿Estás seguro de eliminar el curso "+V((y=a(p))==null?void 0:y.name)+", se borrará toda la información relacionada? ",1)]}),_:1}),e(m,null,{default:l(()=>[e(n),e(t,{variant:"tonal",text:"Cancelar",onClick:b,disabled:a(D),color:"error"},null,8,["disabled"]),e(t,{variant:"tonal",text:"Confirmar",onClick:h,loading:a(D),color:"primary"},null,8,["loading"])]),_:1})]),_:1})}}});export{he as _,Ce as a,Te as b,X as u};
